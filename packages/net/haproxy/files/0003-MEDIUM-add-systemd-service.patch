From 58a130aa81824183c22896e9c63a010693f96a76 Mon Sep 17 00:00:00 2001
From: Marc-Antoine Perennou <Marc-Antoine@Perennou.com>
Date: Fri, 8 Feb 2013 14:35:34 +0100
Subject: [[V3] 3/3] MEDIUM: add systemd service

Signed-off-by: Marc-Antoine Perennou <Marc-Antoine@Perennou.com>
---
 .gitignore                         |  1 +
 contrib/systemd/Makefile           |  8 ++++++++
 contrib/systemd/haproxy.service.in | 11 +++++++++++
 3 files changed, 20 insertions(+)
 create mode 100644 contrib/systemd/Makefile
 create mode 100644 contrib/systemd/haproxy.service.in

diff --git a/.gitignore b/.gitignore
index 5e6f556..ec1545a 100644
--- a/.gitignore
+++ b/.gitignore
@@ -16,3 +16,4 @@ haproxy-*
 make-*
 dlmalloc.c
 00*.patch
+*.service
diff --git a/contrib/systemd/Makefile b/contrib/systemd/Makefile
new file mode 100644
index 0000000..e542c23
--- /dev/null
+++ b/contrib/systemd/Makefile
@@ -0,0 +1,8 @@
+PREFIX = /usr/local
+SBINDIR = $(PREFIX)/sbin
+
+haproxy.service: haproxy.service.in
+	sed -e 's:@SBINDIR@:'$(strip $(SBINDIR))':' $< > $@
+
+clean:
+	rm -f haproxy.service
diff --git a/contrib/systemd/haproxy.service.in b/contrib/systemd/haproxy.service.in
new file mode 100644
index 0000000..1a3d2c0
--- /dev/null
+++ b/contrib/systemd/haproxy.service.in
@@ -0,0 +1,11 @@
+[Unit]
+Description=HAProxy Load Balancer
+After=network.target
+
+[Service]
+ExecStart=@SBINDIR@/haproxy-systemd-wrapper -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid
+ExecReload=/bin/kill -USR2 $MAINPID
+Restart=always
+
+[Install]
+WantedBy=multi-user.target
-- 
1.8.1.2

