From d2a42538b1e349027e31bc2cb065e50af6294533 Mon Sep 17 00:00:00 2001
From: Sage Weil <sage@inktank.com>
Date: Mon, 20 May 2013 13:34:05 -0700
Subject: [PATCH] mds: better error check on sessionmap load

Would have helped with #5104.

Signed-off-by: Sage Weil <sage@inktank.com>
---
 src/mds/SessionMap.cc |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/src/mds/SessionMap.cc b/src/mds/SessionMap.cc
index 53fe90c..f17fa9e 100644
--- a/src/mds/SessionMap.cc
+++ b/src/mds/SessionMap.cc
@@ -18,6 +18,7 @@
 #include "osdc/Filer.h"
 
 #include "common/config.h"
+#include "common/errno.h"
 #include "include/assert.h"
 
 #define dout_subsys ceph_subsys_mds
@@ -77,6 +78,10 @@ void SessionMap::load(Context *onload)
 void SessionMap::_load_finish(int r, bufferlist &bl)
 { 
   bufferlist::iterator blp = bl.begin();
+  if (r < 0) {
+    derr << "_load_finish got " << cpp_strerror(r) << dendl;
+    assert(0 == "failed to load sessionmap");
+  }
   dump();
   decode(blp);  // note: this sets last_cap_renew = now()
   dout(10) << "_load_finish v " << version 
-- 
1.7.2.5

