# Copyright 2024 David Legrand <david.legrand@clever-cloud.com>
# Distributed under the terms of the GNU General Public License v2

require alternatives

export_exlib_phases src_install

SUMMARY="The modern PHP app server"
HOMEPAGE="https://frankenphp.dev/"

MY_PN="frankenphp"

DOWNLOADS="
    platform:amd64? ( https://github.com/php/frankenphp/releases/download/v${PV}/frankenphp-linux-x86_64-gnu -> ${PNV} )
    platform:armv8? ( https://github.com/php/frankenphp/releases/download/v${PV}/frankenphp-linux-aarch64-gnu  -> ${PNV} )
"

LICENCES="MIT"
SLOT="$(ever range 1-2)"
MYOPTIONS="
    ( platform: amd64 armv8 )
"

DEPENDENCIES="
    build+run:
        !${CATEGORY}/${PN}:0 [[
            description = [ Slotify frankenphp-bin ]
            resolution = uninstall-blocked-before
        ]]

"

RESTRICT="
    platform:amd64? ( strip )
"

WORK="${WORKBASE}"

frankenphp-bin_src_install() {
    newbin "${FETCHEDDIR}"/${PNV} ${MY_PN}-${SLOT}

    alternatives_for "${MY_PN}" "${SLOT}" "${SLOT}" \
        /usr/$(exhost --target)/bin/${MY_PN} ${MY_PN}-${SLOT}
}

