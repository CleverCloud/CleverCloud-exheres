From 1e848f656508e6cec5dec9b90a117d4fbbc04148 Mon Sep 17 00:00:00 2001
From: kannar <kannarfr@gmail.com>
Date: Mon, 20 Mar 2023 14:17:18 +0100
Subject: [PATCH] enhancement(service): systemd service restart always (#16822)

* add restart always

* apply suggestion

Co-authored-by: Spencer Gilbert <Spencer.Gilbert@gmail.com>

* apply suggestion

Co-authored-by: Spencer Gilbert <Spencer.Gilbert@gmail.com>

* apply suggestion

Co-authored-by: Spencer Gilbert <Spencer.Gilbert@gmail.com>

---------

Co-authored-by: Spencer Gilbert <Spencer.Gilbert@gmail.com>
---
 distribution/systemd/vector.service | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/distribution/systemd/vector.service b/distribution/systemd/vector.service
index 150291ec6..d9c6e7843 100644
--- a/distribution/systemd/vector.service
+++ b/distribution/systemd/vector.service
@@ -11,9 +11,12 @@ ExecStartPre=/usr/bin/vector validate
 ExecStart=/usr/bin/vector
 ExecReload=/usr/bin/vector validate
 ExecReload=/bin/kill -HUP $MAINPID
-Restart=no
+Restart=always
 AmbientCapabilities=CAP_NET_BIND_SERVICE
 EnvironmentFile=-/etc/default/vector
-
+# Since systemd 229, should be in [Unit] but in order to support systemd <229,
+# it is also supported to have it here.
+StartLimitInterval=10
+StartLimitBurst=5
 [Install]
 WantedBy=multi-user.target
-- 
2.39.1

